<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    body {
        padding: 0;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #PlayGround {

        border: 5px black solid;
    }
</style>

<body>
    <canvas id="PlayGround" width="700px" height="700px">

    </canvas>
</body>
<script>
    class PlayerBall {
        constructor(x, y, radius) {
            this.x = x;
            this.y = y;
            this.radius = radius;

        }

        isColision(entity2) {
            return !(this.x - this.radius + this.radius * 2 < entity2.x ||
                entity2.x + entity2.width < this.x - this.radius ||
                this.y - this.radius + this.radius * 2 < entity2.y ||
                entity2.y + entity2.height < this.y - this.radius);
        }
        isOverColision(entity2) {
            return this.isColision(entity2) && this.y - this.radius + this.radius * 2 == entity2.y
        }
        isUnderColision(entity2) {
            return this.isColision(entity2) && this.y - this.radius == entity2.y + entity2.height
        }
        isLeftColision(entity2) {
            return this.isColision(entity2) && this.x - this.radius == entity2.x + entity2.width
        }
        isRightColision(entity2) {
            return this.isColision(entity2) && this.x - this.radius + this.radius * 2 == entity2.x;
        }
    }

    class Element {
        constructor(x, y, height, width, name) {
            this.x = x;
            this.y = y;
            this.height = height;
            this.width = width;
            this.name = name;
            this.active = true;
        }

        createElement(ctx) {
            if (this.active) {
                ctx.beginPath();
                ctx.rect(this.x, this.y, this.height, this.width);
                ctx.fillStyle = "black";
                if (this.name == "start") {
                    ctx.fillStyle = "green";
                }
                else if (this.name == "end") {
                    ctx.fillStyle = "red";
                }
                ctx.fill();
            }
        }
    }

    let elementArray = [];
    elementArray.push(new Element(0, 0, 700, 10, "wall"));
    elementArray.push(new Element(0, 0, 10, 700, "wall"));
    elementArray.push(new Element(0, 690, 700, 10, "wall"));
    elementArray.push(new Element(690, 0, 10, 700, "wall"));
    elementArray.push(new Element(70, 0, 15, 600, "wall"));
    elementArray.push(new Element(70, 600, 100, 15, "wall"));
    elementArray.push(new Element(170, 530, 70, 15, "wall"));
    elementArray.push(new Element(240, 530, 15, 170, "wall"));
    elementArray.push(new Element(160, 70, 15, 475, "wall"));
    elementArray.push(new Element(170, 70, 440, 15, "wall"));
    elementArray.push(new Element(610, 70, 15, 400, "wall"));
    elementArray.push(new Element(170, 70, 440, 15, "wall"));
    elementArray.push(new Element(540, 530, 150, 15, "wall"));
    elementArray.push(new Element(540, 150, 15, 380, "wall"));
    elementArray.push(new Element(240, 150, 300, 15, "wall"));
    elementArray.push(new Element(240, 150, 15, 290, "wall"));
    elementArray.push(new Element(240, 440, 100, 15, "wall"));
    elementArray.push(new Element(340, 440, 15, 160, "wall"));
    elementArray.push(new Element(340, 600, 270, 15, "wall"));
    elementArray.push(new Element(340, 250, 120, 15, "wall"));
    elementArray.push(new Element(460, 250, 15, 350, "wall"));
    elementArray.push(new Element(340, 250, 15, 120, "wall"));
    //elementArray.push(new Element(0, 0, 70, 70, "start"));
    // elementArray.push(new Element(355, 250, 115, 350, "end"));
    let canvasElement = document.getElementById('PlayGround');
    let ctx = canvasElement.getContext('2d');

    for (let i = 0; i < elementArray.length; i++) {
        console.log('test')
        elementArray[i].createElement(ctx);
    }

    let playerObject = new PlayerBall(100, 100, 10);
    let y = 0;
    let x = 0
    let Gamma = 0;
    let Beta = 0;
    let moveX = 0;
    let moveY = 0;

    function handleOrientation(event) {
        Gamma = event.gamma;
        Beta = event.beta;
        y = event.beta;
        x = event.gamma;

        // Because we don't want to have the device upside dow
        // We constrain the x value to the range [-90,90]
        if (x > 90) { x = 90 };
        if (x < -90) { x = -90 };

        if (Math.abs(x) + Math.abs(Gamma) > Math.abs(y) + Math.abs(Beta)) {
            if (x > 0) {
                moveX = - 1;
                moveY = 0;
            }
            else if (x < 0) {
                moveX = 1;
                moveY = 0;
            }
        }
        else {
            if (y > 0) {
                moveY = 1;
                moveX = 0;
            }
            else if (y < 0) {
                moveY = - 1;
                moveX = 0;
            }
        }
    }


    window.addEventListener('deviceorientation', handleOrientation);

    document.addEventListener("keypress", (e) => {
        switch (e.charCode) {
            case 119: moveY = -1; moveX = 0;
                break;//w
            case 115: moveY = 1; moveX = 0;
                break;//s
            case 97: moveX = -1; moveY = 0;
                break;//a
            case 100: moveX = 1; moveY = 0;
                break;//d            
        }
    })

    function moveBall(_playerObject, _moveX, _moveY) {
        ctx.clearRect(_playerObject.x - _playerObject.radius - 1, _playerObject.y - _playerObject.radius - 1, _playerObject.radius * 2 + 2, _playerObject.radius * 2 + 2);

        ctx.beginPath();
        ctx.fillStyle = "rgb(0,0,0)";
        _playerObject.x += moveX;
        _playerObject.y += moveY;
        ctx.arc(_playerObject.x, _playerObject.y, _playerObject.radius, 0, 360 * Math.PI / 180);
        ctx.fill();
        ctx.closePath();
    }

    setInterval(() => {
        for (let a = 0; a < elementArray.length; a++) {
            if (playerObject.isColision(elementArray[a]) && elementArray[a].name == "wall") {
                if (playerObject.isOverColision(elementArray[a])) {
                    moveBall(playerObject, moveX, -Math.abs(moveY));
                }
                else if (playerObject.isUnderColision(elementArray[a])) {
                    moveBall(playerObject, moveX, Math.abs(moveY));
                }
                else if (playerObject.isRightColision(elementArray[a])) {
                    moveBall(playerObject, Math.abs(moveX), moveY);
                }
                else if (playerObject.isLeftColision(elementArray[a])) {
                    moveBall(playerObject, -Math.abs(moveX), moveY)
                }
            }
        }
        if (!(playerObject.isColision(elementArray[0])||playerObject.isColision(elementArray[1])||playerObject.isColision(elementArray[2])||playerObject.isColision(elementArray[3])||playerObject.isColision(elementArray[4])||playerObject.isColision(elementArray[5])||playerObject.isColision(elementArray[6])||playerObject.isColision(elementArray[7])||playerObject.isColision(elementArray[8])||playerObject.isColision(elementArray[9])||playerObject.isColision(elementArray[10])||playerObject.isColision(elementArray[11])||playerObject.isColision(elementArray[12])||playerObject.isColision(elementArray[13])||playerObject.isColision(elementArray[14])||playerObject.isColision(elementArray[15])||playerObject.isColision(elementArray[16])||playerObject.isColision(elementArray[17])||playerObject.isColision(elementArray[18])||playerObject.isColision(elementArray[19])||playerObject.isColision(elementArray[20])||playerObject.isColision(elementArray[21])))
            moveBall(playerObject, moveX, moveY)
    }, 10)

</script>

</html>